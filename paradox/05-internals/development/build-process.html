<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=v1.5.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../cloud">
<title>Build Process Â· Knora Documentation</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="blue"
data-md-color-accent="yellow"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="Knora Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">cloud</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Knora Documentation
</span>
<span class="md-header-nav__topic">
Build Process
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/dhlab-basel/Knora/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
dhlab-basel/Knora/docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">cloud</i>
</span>
<a href="../../index.html" title="Knora Documentation">
Knora Documentation
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/dhlab-basel/Knora/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
dhlab-basel/Knora/docs
</div>
</a>

</div>
<ul>
  <li><a href="../../00-release-notes/index.html" class="page">Release Notes</a>
  <ul>
    <li><a href="../../00-release-notes/v1.1.0.html" class="page">v1.1.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.2.0.html" class="page">v1.2.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.3.0.html" class="page">v1.3.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.4.0.html" class="page">v1.4.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.5.0.html" class="page">v1.5.0 Release Notes</a></li>
    <li><a href="../../00-release-notes/v1.6.0.html" class="page">v1.6.0 Release Notes (not released yet)</a></li>
  </ul></li>
  <li><a href="../../01-introduction/index.html" class="page">Introduction</a>
  <ul>
    <li><a href="../../01-introduction/what-is-knora.html" class="page">What Is Knora?</a></li>
    <li><a href="../../01-introduction/example-project.html" class="page">An Example Project</a></li>
  </ul></li>
  <li><a href="../../02-knora-ontologies/index.html" class="page">Knora Ontologies</a>
  <ul>
    <li><a href="../../02-knora-ontologies/introduction.html" class="page">Introduction</a></li>
    <li><a href="../../02-knora-ontologies/knora-base.html" class="page">The Knora Base Ontology</a></li>
    <li><a href="../../02-knora-ontologies/salsah-gui.html" class="page">The SALSAH GUI Ontology</a></li>
  </ul></li>
  <li><a href="../../03-apis/index.html" class="page">The Knora APIs</a>
  <ul>
    <li><a href="../../03-apis/api-v1/index.html" class="page">Knora API v1</a></li>
    <li><a href="../../03-apis/api-v2/index.html" class="page">Knora API v2</a></li>
    <li><a href="../../03-apis/api-admin/index.html" class="page">Knora Admin API</a></li>
  </ul></li>
  <li><a href="../../04-deployment/index.html" class="page">Deploying Knora</a>
  <ul>
    <li><a href="../../04-deployment/getting-started.html" class="page">Getting Started with Knora</a></li>
  </ul></li>
  <li><a href="../../05-internals/index.html" class="page">Knora Internals</a>
  <ul>
    <li><a href="../../05-internals/design/index.html" class="page">Design</a></li>
    <li><a href="../../05-internals/development/index.html" class="page">Development</a></li>
  </ul></li>
  <li><a href="../../06-salsah/index.html" class="page">The SALSAH 1 GUI</a></li>
  <li><a href="../../07-sipi/index.html" class="page">The Sipi Media Server</a>
  <ul>
    <li><a href="../../07-sipi/setup-sipi-for-knora.html" class="page">Setting Up Sipi for Knora</a></li>
    <li><a href="../../07-sipi/sipi-and-knora.html" class="page">Interaction Between Sipi and Knora</a></li>
  </ul></li>
  <li><a href="../../faq.html" class="page">Frequently Asked Questions</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../../05-internals/development/build-process.html#build-process" class="header">Build Process</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#building-and-running" class="header">Building and Running</a></li>
    <li><a href="../../05-internals/development/build-process.html#running-the-automated-tests" class="header">Running the automated tests</a></li>
    <li><a href="../../05-internals/development/build-process.html#load-testing-on-mac-os-x" class="header">Load Testing on Mac OS X</a></li>
    <li><a href="../../05-internals/development/build-process.html#continuous-integration" class="header">Continuous Integration</a></li>
    <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
    <li><a href="../../05-internals/development/build-process.html#webapi-server-startup-flags" class="header">Webapi Server Startup-Flags</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> v1.5.0
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../../05-internals/development/build-process.html#build-process" class="header">Build Process</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#building-and-running" class="header">Building and Running</a></li>
    <li><a href="../../05-internals/development/build-process.html#running-the-automated-tests" class="header">Running the automated tests</a></li>
    <li><a href="../../05-internals/development/build-process.html#load-testing-on-mac-os-x" class="header">Load Testing on Mac OS X</a></li>
    <li><a href="../../05-internals/development/build-process.html#continuous-integration" class="header">Continuous Integration</a></li>
    <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
    <li><a href="../../05-internals/development/build-process.html#webapi-server-startup-flags" class="header">Webapi Server Startup-Flags</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<!---
Copyright Â© 2015-2018 the contributors (see Contributors.md).

This file is part of Knora.

Knora is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Knora is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with Knora.  If not, see <http://www.gnu.org/licenses/>.
-->
<h1><a href="#build-process" name="build-process" class="anchor"><span class="anchor-link"></span></a>Build Process</h1>
<div class="toc ">
<ul>
  <li><a href="../../05-internals/development/build-process.html#building-and-running" class="header">Building and Running</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#starting-a-triplestore" class="header">Starting a Triplestore</a></li>
  </ul></li>
  <li><a href="../../05-internals/development/build-process.html#running-the-automated-tests" class="header">Running the automated tests</a></li>
  <li><a href="../../05-internals/development/build-process.html#load-testing-on-mac-os-x" class="header">Load Testing on Mac OS X</a></li>
  <li><a href="../../05-internals/development/build-process.html#continuous-integration" class="header">Continuous Integration</a></li>
  <li><a href="../../05-internals/development/build-process.html#sbt-build-configuration" class="header">SBT Build Configuration</a></li>
  <li><a href="../../05-internals/development/build-process.html#webapi-server-startup-flags" class="header">Webapi Server Startup-Flags</a>
  <ul>
    <li><a href="../../05-internals/development/build-process.html#loaddemodata-flag" class="header"><code>loadDemoData</code> - Flag</a></li>
    <li><a href="../../05-internals/development/build-process.html#allowreloadoverhttp-flag" class="header"><code>allowReloadOverHTTP</code> - Flag</a></li>
  </ul></li>
</ul>
</div>
<p>TODO: complete this file.</p>
<ul>
  <li>SBT</li>
  <li>Using GraphDB for development and how to initialize the &lsquo;knora-test-unit&rsquo; repository</li>
  <li>Using Fuseki for development</li>
</ul>
<h2><a href="#building-and-running" name="building-and-running" class="anchor"><span class="anchor-link"></span></a>Building and Running</h2>
<h3><a href="#starting-a-triplestore" name="starting-a-triplestore" class="anchor"><span class="anchor-link"></span></a>Starting a Triplestore</h3>
<p>Start a triplestore (GraphDB-Free or GraphDB-SE). Download distribution from <a href="http://ontotext.com">Ontotext</a>. Unzip distribution  to a place of your choosing and run the following:</p>
<pre><code>$ cd /to/unziped/location
$ ./bin/graphdb -Dgraphdb.license.file=/path/to/GRAPHDB_SE.license
</code></pre>
<p>Here we use GraphDB-SE which needs to be licensed separately.</p>
<p>Then in another terminal, initialize the data repository and load some test data:</p>
<pre><code>$ cd KNORA_PROJECT_DIRECTORY/webapi/scripts
$ ./graphdb-se-local-init-knora-test.sh
</code></pre>
<p>Then go back to the webapi root directory and use SBT to start the API server:</p>
<pre><code>$ cd KNORA_PROJECT_DIRECTORY/webapi
$ sbt
&gt; compile
&gt; reStart
</code></pre>
<p>To shut down Knora:</p>
<pre><code>&gt; re-stop
</code></pre>
<h2><a href="#running-the-automated-tests" name="running-the-automated-tests" class="anchor"><span class="anchor-link"></span></a>Running the automated tests</h2>
<p>Make sure you&rsquo;ve started the triplestore as shown above.</p>
<p>Then in another terminal, initialise the repository used for automated testing:</p>
<pre><code>$ cd KNORA_PROJECT_DIRECTORY/webapi/scripts
$ ./graphdb-se-local-init-knora-test-unit.sh
</code></pre>
<p>Run the automated tests from sbt:</p>
<pre><code>&gt; graphdb:test
</code></pre>
<h2><a href="#load-testing-on-mac-os-x" name="load-testing-on-mac-os-x" class="anchor"><span class="anchor-link"></span></a>Load Testing on Mac OS X</h2>
<p>To test Knora with many concurrent connections on Mac OS X, you will need to adjust some kernel parameters to allow more open connections, to recycle ephemeral ports more quickly, and to use a wider range of ephemeral port numbers. The script <code>webapi/scripts/macOS-kernel-test-config.sh</code> will do this.</p>
<h2><a href="#continuous-integration" name="continuous-integration" class="anchor"><span class="anchor-link"></span></a>Continuous Integration</h2>
<p>For continuous integration testing, we use Travis-CI. Every commit pushed to the git repository or every pull request, triggers the build. Additionaly, in Github there is a litle checkmark beside every commit, signaling the status of the build (successful, unsucessful, ongoing).</p>
<p>The build that is executed on Travis-CI is defined in <code>.travis.yml</code> situated in the root folder of the project, and looks like this:</p>
<pre class="prettyprint"><code class="language-yml">dist: trusty
sudo: required

addons:
  chrome: stable

git:
  depth: 1

language: scala

scala:
  - 2.12.1

jdk:
  - oraclejdk8

services:
  - docker

env:
  global:
    - WEBAPI_REPO=dhlabbasel/webapi
    - SALSAH1_REPO=dhlabbasel/salsah1
    - SALSAH2_REPO=dhlabbasel/salsah2
    - SIPI_REPO=dhlabbasel/sipi
    - DOCKERHOST=$(ip route get 8.8.8.8 | awk &#39;{print $NF; exit}&#39;)
    - CHROME_BIN=google-chrome-stable
    - GDB_HEAP_SIZE=&quot;2G&quot;
    - TAG=${TRAVIS_BRANCH//\//-}
    - GRAPHDB_VERSION=&quot;8.5.0-se&quot;

before_cache:
    - sudo chown -R travis:travis $HOME/.ivy2
    
cache:
  directories:
    - $HOME/.ivy2

before_install:
  - openssl aes-256-cbc -K $encrypted_6254b38dc8d5_key -iv $encrypted_6254b38dc8d5_iv -in $TRAVIS_BUILD_DIR/private/graphdb.license.enc -out $TRAVIS_BUILD_DIR/private/graphdb.license -d
  - sudo apt-get -qq update
  - sudo apt-get install -y expect

stages:
  - test
  - name: publish # generally, only publish if we are on &#39;develop&#39; or tagged
    if: branch = develop OR tag IS present

jobs:
  include:
    # unit and e2e tests
    - stage: test
      script:
        # prepare needed graphdb-se files
        - mkdir -p $TRAVIS_BUILD_DIR/data/conf
        - cp $TRAVIS_BUILD_DIR/private/graphdb.license $TRAVIS_BUILD_DIR/data/conf/graphdb.license
        - mkdir -p $TRAVIS_BUILD_DIR/graphdb
        - cp $TRAVIS_BUILD_DIR/webapi/scripts/KnoraRules.pie $TRAVIS_BUILD_DIR/graphdb
        # start and initialize graphdb-se
        - docker run -d -p 127.0.0.1:7200:7200 -v $TRAVIS_BUILD_DIR/data:/opt/graphdb/home -v $TRAVIS_BUILD_DIR/graphdb:/graphdb -e GDB_HEAP_SIZE=$GDB_HEAP_SIZE ontotext/graphdb:$GRAPHDB_VERSION
        - sleep 15
        - cd $TRAVIS_BUILD_DIR/webapi/scripts &amp;&amp; ./graphdb-se-docker-init-knora-test-unit.sh
        # start the built-in webapi server tests
        - cd $TRAVIS_BUILD_DIR/webapi/ &amp;&amp; sbt graphdb:test
        # test sbt stage
        - cd $TRAVIS_BUILD_DIR/webapi/ &amp;&amp; sbt stage
        # only uncomment if docker image is needed for this branch. remove before merging into develop
        # - docker login -u $DOCKER_USER -p $DOCKER_PASS
        # - docker build $TRAVIS_BUILD_DIR/webapi/ -t $WEBAPI_REPO:$TAG
        # - docker push $WEBAPI_REPO
    # integration tests
    - stage: test
      script:
        # prepare needed graphdb-se files
        - mkdir -p $TRAVIS_BUILD_DIR/data/conf
        - cp $TRAVIS_BUILD_DIR/private/graphdb.license $TRAVIS_BUILD_DIR/data/conf/graphdb.license
        - mkdir -p $TRAVIS_BUILD_DIR/graphdb
        - cp $TRAVIS_BUILD_DIR/webapi/scripts/KnoraRules.pie $TRAVIS_BUILD_DIR/graphdb
        # start and initialize graphdb-se
        - docker run -d -p 127.0.0.1:7200:7200 -v $TRAVIS_BUILD_DIR/data:/opt/graphdb/home -v $TRAVIS_BUILD_DIR/graphdb:/graphdb -e GDB_HEAP_SIZE=$GDB_HEAP_SIZE ontotext/graphdb:$GRAPHDB_VERSION
        - sleep 15
        - cd $TRAVIS_BUILD_DIR/webapi/scripts &amp;&amp; ./graphdb-se-docker-init-knora-test-unit.sh
        # start the sipi container (with production config)
        - cd $TRAVIS_BUILD_DIR/sipi/ &amp;&amp; docker run -d --add-host webapihost:$DOCKERHOST -v $PWD/config:/sipi/config -v $PWD/scripts:/sipi/scripts -v /tmp:/tmp -v $HOME:$HOME -p 1024:1024 dhlabbasel/sipi:develop --config=/sipi/config/sipi.knora-docker-it-config.lua
        # start the integration tests
        - cd $TRAVIS_BUILD_DIR/webapi/ &amp;&amp; sbt it:test
    # testing docs generation
    - stage: test
      script:
        # install the necessary packages
        - sudo apt-get install -y graphviz software-properties-common
        - sudo apt-add-repository -y ppa:rael-gc/rvm
        - sudo apt-get update
        - sudo apt-get install rvm
        - rvm install ruby 2.5.1
        - rvm use 2.5.1 --default
        - ruby -v
        # install bundler
        - gem install bundler
        # install jekyll
        # - gem install jekyll -v 3.8.1
        # install typedoc
        - npm install --global typedoc
        # install jekyll dependencies
        - cd $TRAVIS_BUILD_DIR/docs/src/jekyll &amp;&amp; bundle install
        # compile and build all docs (paradox, typescript, jekyll)
        - cd $TRAVIS_BUILD_DIR/docs &amp;&amp; sbt makeSite
    # Salsah browser tests
    #- stage: test
    #  script:
    #    # prepare needed graphdb-se files
    #    - mkdir -p $TRAVIS_BUILD_DIR/data/conf
    #    - cp $TRAVIS_BUILD_DIR/private/graphdb.license $TRAVIS_BUILD_DIR/data/conf/graphdb.license
    #    - mkdir -p $TRAVIS_BUILD_DIR/graphdb
    #    - cp $TRAVIS_BUILD_DIR/webapi/scripts/KnoraRules.pie $TRAVIS_BUILD_DIR/graphdb
    #    # start and initialize graphdb-se
    #    - docker run -d -p 127.0.0.1:7200:7200 -v $TRAVIS_BUILD_DIR/data:/opt/graphdb/home -v $TRAVIS_BUILD_DIR/graphdb:/graphdb -e GDB_HEAP_SIZE=$GDB_HEAP_SIZE ontotext/graphdb:$GRAPHDB_VERSION
    #    - sleep 15
    #    - cd $TRAVIS_BUILD_DIR/webapi/scripts &amp;&amp; ./graphdb-se-docker-init-knora-test.sh
    #    # start the sipi container (with test config)
    #    - docker run -d --add-host webapihost:$DOCKERHOST -v /tmp:/tmp -v $HOME:$HOME -p 1024:1024 $SIPI_REPO:develop /sipi/local/bin/sipi --config=/sipi/config/sipi.knora-test-docker-config.lua
    #    # start the webapi and salsah1 server
    #    - cd $TRAVIS_BUILD_DIR/webapi/ &amp;&amp; sbt &quot;run allowReloadOverHTTP&quot; &amp;
    #    - cd $TRAVIS_BUILD_DIR/salsah1/ &amp;&amp; sbt run &amp;
    #    # wait for the webapi server to start before we proceed with running the salsah tests
    #    - until netstat -an 2&gt;/dev/null | grep &#39;3333.*LISTEN&#39;; do true; done
    #    # unzip chromedriver
    #    - cd $TRAVIS_BUILD_DIR/salsah1/lib/chromedriver/ &amp;&amp; unzip chromedriver_linux64.zip
    #    # start built-in salsah1 browser tests
    #    - cd $TRAVIS_BUILD_DIR/salsah1/ &amp;&amp; sbt headless:test
    - stage: publish
      script:
        # login into docker hub, build image, and push but only when on the &quot;develop&quot; branch or tagged
        # when on &#39;develop&#39; then $TRAVIS_BRANCH = develop
        # when on &#39;tag&#39; then $TRAVIS_BRANCH = tag, e.g., v1.2.0
        - docker login -u $DOCKER_USER -p $DOCKER_PASS
        # webapi
        - docker build $TRAVIS_BUILD_DIR/webapi/ -t $WEBAPI_REPO:$TRAVIS_BRANCH
        - docker tag $WEBAPI_REPO:$TRAVIS_BRANCH $WEBAPI_REPO:latest
        - docker push $WEBAPI_REPO
        # salsah1
        - docker build $TRAVIS_BUILD_DIR/salsah1/ -t $SALSAH1_REPO:$TRAVIS_BRANCH
        - docker tag $SALSAH1_REPO:$TRAVIS_BRANCH $SALSAH1_REPO:latest
        - docker push $SALSAH1_REPO
        # sipi: get the develop sipi and tag it as &#39;develop-knora&#39; so we know that this version is tested (only on the develop branch)
        - docker pull $SIPI_REPO:develop
        - docker tag $SIPI_REPO:develop $SIPI_REPO:knora-$TRAVIS_BRANCH
        - docker push $SIPI_REPO

notifications:
  slack:
    secure: gaazomUbAB4q7bH2XOiZXqHvU2gd/X/jIRLAJW9vjcRbY6o48eiEdNXF2umraHG0q+5UUEJ5dfvxiPtC4PiUq8uD6J+R0fEWrWznYoIeEWEXjKxRxWplrWJ9Ke+PJb3wCV6cXBGMfxDpvYQbVjsy7n0aQmjNs4Drz+llqL5SilTdswTylwvUdufad0QaovXklL+p0w9vRHRKzQkYKa9phL10VcJa8TPI74tuFcTHnK6TcMNW6p0vzAaF6JVgzoRPzUgXnEPCw4pI8zqOF1ghPpQByNXKiYofPWt1yTFgb60LQarDEiHXunXAA/sf2gx616pWLVjDFGziXVzhiGUDUjM5I1p7hPyA2rTB63AAZustFcGeD+jbHNHIFhcvvCHVHjJfp8M7LrUR+MBqz5mJNi/9KgxyZ8I9Df28TxmKxGFaGW8t4PZdA75/49Hos0TqtIp5m+eo8mTksUJogEJJokRZUKraMBhC0cNCry0kp+EQ06F4usLoDyZTUar4OSuNSiymf+zwz6jZo8dF/cluRYellwewE9NJiNWGN4DiBhk2vGJ7OtWMDPkl1tqkG8npoqbT4s38esjxfa/XcworGfeqE+9mzugVzkIKIX2lB6QxZp0AKQVOiy7JwwdtcjVMLvceiNPEWfe8fhLMX02oqYz2uoibRmHMxKPa5CpmUIg=</code></pre>
<p>It basically means:</p>
<ul>
  <li>use the virtual machine based environment (line 1)</li>
  <li>checkout git with a shorter history (lines 2-3)</li>
  <li>add scala libraries (lines 4-6)</li>
  <li>add oracle jdk version 8 (lines 7-8)</li>
  <li>cache some directories between builds to make it faster (line  9-11)</li>
  <li>start fuseki and afterwards start all tests (lines 12-14)</li>
  <li>send notification to our slack channel (lines 15-17)</li>
</ul>
<h2><a href="#sbt-build-configuration" name="sbt-build-configuration" class="anchor"><span class="anchor-link"></span></a>SBT Build Configuration</h2>
<pre class="prettyprint"><code class="language-sbt">import sbt._
import NativePackagerHelper._
import sbt.io.IO
import sbtassembly.MergeStrategy
import sbtassembly.MergeStrategy._

connectInput in run := true

// Bring the sbt-aspectj settings into this build
//aspectjSettings

lazy val webapi = (project in file(&quot;.&quot;)).
        configs(
            FusekiTest,
            FusekiIntegrationTest,
            GraphDBTest,
            EmbeddedJenaTDBTest,
            IntegrationTest
        ).
        settings(webApiCommonSettings:  _*).
        settings(inConfig(Test)(
            Defaults.testTasks ++ baseAssemblySettings
        ): _*).
        settings(inConfig(Gatling)( // add our settings to the gatling config
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaTestOptions
            )
        ): _*).
        settings(inConfig(GatlingIt)( // add our settings to the gatling it config
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaTestOptions
            )
        ): _*).
        settings(inConfig(FusekiTest)(
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaFusekiTestOptions,
                testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
            )
        ): _*).
        settings(inConfig(FusekiIntegrationTest)(
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaFusekiIntegrationTestOptions,
                testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
            )
        ): _*).
        settings(inConfig(GraphDBTest)(
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaGraphDBTestOptions,
                testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
            )
        ): _*).
        settings(inConfig(EmbeddedJenaTDBTest)(
            Defaults.testTasks ++ Seq(
                fork := true,
                javaOptions ++= javaEmbeddedJenaTDBTestOptions,
                testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
            )
        ): _*).
        settings(inConfig(IntegrationTest)(
            Defaults.itSettings ++ Seq(
                fork := true,
                javaOptions ++= javaIntegrationTestOptions,
                testOptions += Tests.Argument(&quot;-oDF&quot;) // show full stack traces and test case durations
            ) ++ baseAssemblySettings
        ): _*).
        settings(
            libraryDependencies ++= webApiLibs,
            scalacOptions ++= Seq(&quot;-feature&quot;, &quot;-unchecked&quot;, &quot;-deprecation&quot;, &quot;-Yresolve-term-conflict:package&quot;),
            logLevel := Level.Info,
            fork in run := true,
            javaOptions in run ++= javaRunOptions,
            javaOptions in reStart ++= javaRunOptions,
            javaOptions in Test ++= javaTestOptions,
            javaOptions in reStart ++= resolvedJavaAgents.value map { resolved =&gt;
                &quot;-javaagent:&quot; + resolved.artifact.absolutePath + resolved.agent.arguments
            },// allows sbt-javaagent to work with sbt-revolver
            javaAgents += library.aspectJWeaver,
            mainClass in (Compile, run) := Some(&quot;org.knora.webapi.Main&quot;),
            fork in Test := true,
            parallelExecution in Test := false,
            // enable publishing the jar produced by `sbt test:package` and `sbt it:package`
            publishArtifact in (Test, packageBin) := true,
            publishArtifact in (IntegrationTest, packageBin) := true
        ).
        settings( // enable deployment staging with `sbt stage`. uses fat jar assembly.
            // we specify the name for our fat jars (main, test, it)
            assemblyJarName in assembly := s&quot;assembly-${name.value}-main-${version.value}.jar&quot;,
            assemblyJarName in (Test, assembly) := s&quot;assembly-${name.value}-test-${version.value}.jar&quot;,
            assemblyJarName in (IntegrationTest, assembly) := s&quot;assembly-${name.value}-it-${version.value}.jar&quot;,
            // disable running of tests before fat jar assembly!
            test in assembly := {},
            test in (Test, assembly) := {},
            test in (IntegrationTest, assembly) := {},
            // need to use our custom merge strategy because of aop.xml (AspectJ)
            assemblyMergeStrategy in assembly := customMergeStrategy,
            // Skip packageDoc task on stage
            mappings in (Compile, packageDoc) := Seq(),
            mappings in Universal := {
                // removes all jar mappings in universal and appends the fat jar
                // universalMappings: Seq[(File,String)]
                val universalMappings = (mappings in Universal).value
                val fatJar = (assembly in Compile).value
                // removing means filtering
                val filtered = universalMappings filter {
                    case (file, name) =&gt;  ! name.endsWith(&quot;.jar&quot;)
                }
                // add the fat jar
                filtered :+ (fatJar -&gt; (&quot;lib/&quot; + fatJar.getName))
            },
            mappings in Universal ++= {
                // copy the scripts folder
                directory(&quot;scripts&quot;) ++
                // copy the configuration files to config directory
                contentOf(&quot;configs&quot;).toMap.mapValues(&quot;config/&quot; + _) ++
                // copy configuration files to config directory
                contentOf(&quot;src/main/resources&quot;).toMap.mapValues(&quot;config/&quot; + _) ++
                // copy the aspectj weaver jar
                contentOf(&quot;vendor&quot;).toMap.mapValues(&quot;aspectjweaver/&quot; + _)
            },
            // the bash scripts classpath only needs the fat jar
            scriptClasspath := Seq( (assemblyJarName in assembly).value ),
            // add &#39;config&#39; directory first in the classpath of the start script,
            scriptClasspath := Seq(&quot;../config/&quot;) ++ scriptClasspath.value,
            // add license
            licenses := Seq((&quot;GNU AGPL&quot;, url(&quot;https://www.gnu.org/licenses/agpl-3.0&quot;))),
            // need this here, so that the Manifest inside the jars has the correct main class set.
            mainClass in Compile := Some(&quot;org.knora.webapi.Main&quot;),
            mainClass in Test := Some(&quot;org.scalatest.tools.Runner&quot;),
            mainClass in IntegrationTest := Some(&quot;org.scalatest.tools.Runner&quot;)
        ).
        enablePlugins(SbtTwirl). // Enable the sbt-twirl plugin
        enablePlugins(JavaAppPackaging). // Enable the sbt-native-packager plugin
        enablePlugins(GatlingPlugin). // load testing
        enablePlugins(JavaAgent). // Adds AspectJ Weaver configuration
        enablePlugins(RevolverPlugin)

lazy val webApiCommonSettings = Seq(
    organization := &quot;org.knora&quot;,
    name := &quot;webapi&quot;,
    version := &quot;1.5.0&quot;,
    scalaVersion := &quot;2.12.4&quot;
)

lazy val webApiLibs = Seq(
    library.aspectJWeaver,
    library.akkaActor,
    library.akkaAgent,
    library.akkaHttp,
    library.akkaHttpCirce,
    library.akkaHttpCors,
    library.akkaHttpSprayJson,
    library.akkaHttpJacksonJava,
    library.akkaHttpTestkit,
    library.akkaHttpXml,
    library.akkaSlf4j,
    library.akkaStream,
    library.akkaStreamTestkit,
    library.akkaTestkit,
    library.bcprov,
    library.commonsBeanUtil,
    library.commonsIo,
    library.commonsText,
    library.commonsValidator,
    library.diff,
    library.ehcache,
    library.gatlingHighcharts,
    library.gatlingTestFramework,
    library.gwtServlet,
    library.jacksonScala,
    library.jsonldJava,
    library.jodd,
    library.jodaTime,
    library.jodaConvert,
    library.jenaLibs,
    library.jenaText,
    library.jwt,
    library.kamonCore,
    library.kamonAkka,
    library.kamonPrometheus,
    library.kamonZipkin,
    library.kamonJaeger,
    library.logbackClassic,
    library.rdf4jRuntime,
    library.saxonHE,
    library.scalaArm,
    library.scalaJava8Compat,
    library.scalaLogging,
    library.scalaTest,
    library.scalaXml,
    library.scallop,
    library.springSecurityCore,
    library.swaggerAkkaHttp,
    library.xmlunitCore
)

lazy val library =
    new {
        object Version {
            val akkaBase = &quot;2.5.11&quot;
            val akkaHttp = &quot;10.1.0&quot;
            val jena = &quot;3.4.0&quot;
        }

        // akka
        val akkaActor              = &quot;com.typesafe.akka&quot;            %% &quot;akka-actor&quot;               % Version.akkaBase
        val akkaAgent              = &quot;com.typesafe.akka&quot;            %% &quot;akka-agent&quot;               % Version.akkaBase
        val akkaStream             = &quot;com.typesafe.akka&quot;            %% &quot;akka-stream&quot;              % Version.akkaBase
        val akkaSlf4j              = &quot;com.typesafe.akka&quot;            %% &quot;akka-slf4j&quot;               % Version.akkaBase
        val akkaTestkit            = &quot;com.typesafe.akka&quot;            %% &quot;akka-testkit&quot;             % Version.akkaBase    % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;
        val akkaStreamTestkit      = &quot;com.typesafe.akka&quot;            %% &quot;akka-stream-testkit&quot;      % Version.akkaBase    % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;

        // akka http
        val akkaHttp               = &quot;com.typesafe.akka&quot;            %% &quot;akka-http&quot;                % Version.akkaHttp
        val akkaHttpXml            = &quot;com.typesafe.akka&quot;            %% &quot;akka-http-xml&quot;            % Version.akkaHttp
        val akkaHttpSprayJson      = &quot;com.typesafe.akka&quot;            %% &quot;akka-http-spray-json&quot;     % Version.akkaHttp
        val akkaHttpJacksonJava    = &quot;com.typesafe.akka&quot;            %% &quot;akka-http-jackson&quot;        % Version.akkaHttp
        val akkaHttpTestkit        = &quot;com.typesafe.akka&quot;            %% &quot;akka-http-testkit&quot;        % Version.akkaHttp    % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;

        // testing
        val scalaTest              = &quot;org.scalatest&quot;                %% &quot;scalatest&quot;                % &quot;3.0.4&quot;             % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;
        val gatlingHighcharts      = &quot;io.gatling.highcharts&quot;         % &quot;gatling-charts-highcharts&quot;% &quot;2.3.1&quot;             % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;
        val gatlingTestFramework   = &quot;io.gatling&quot;                    % &quot;gatling-test-framework&quot;   % &quot;2.3.1&quot;             % &quot;test, fuseki, graphdb, tdb, it, fuseki-it&quot;

        //CORS support
        val akkaHttpCors           = &quot;ch.megard&quot;                    %% &quot;akka-http-cors&quot;           % &quot;0.3.0&quot;

        // jena
        val jenaLibs               = &quot;org.apache.jena&quot;               % &quot;apache-jena-libs&quot;         % Version.jena exclude(&quot;org.slf4j&quot;, &quot;slf4j-log4j12&quot;) exclude(&quot;commons-codec&quot;, &quot;commons-codec&quot;)
        val jenaText               = &quot;org.apache.jena&quot;               % &quot;jena-text&quot;                % Version.jena exclude(&quot;org.slf4j&quot;, &quot;slf4j-log4j12&quot;) exclude(&quot;commons-codec&quot;, &quot;commons-codec&quot;)

        // logging
        val commonsLogging         = &quot;commons-logging&quot;               % &quot;commons-logging&quot;          % &quot;1.2&quot;
        val scalaLogging           = &quot;com.typesafe.scala-logging&quot;   %% &quot;scala-logging&quot;            % &quot;3.8.0&quot;
        val logbackClassic         = &quot;ch.qos.logback&quot;                % &quot;logback-classic&quot;          % &quot;1.2.3&quot;

        // input validation
        val commonsValidator       = &quot;commons-validator&quot;             % &quot;commons-validator&quot;        % &quot;1.6&quot; exclude(&quot;commons-logging&quot;, &quot;commons-logging&quot;)

        // authentication
        val bcprov                 = &quot;org.bouncycastle&quot;              % &quot;bcprov-jdk15on&quot;           % &quot;1.59&quot;
        val springSecurityCore     = &quot;org.springframework.security&quot;  % &quot;spring-security-core&quot;     % &quot;4.2.5.RELEASE&quot; exclude(&quot;commons-logging&quot;, &quot;commons-logging&quot;) exclude(&quot;org.springframework&quot;, &quot;spring-aop&quot;)
        val jwt                    = &quot;io.igl&quot;                       %% &quot;jwt&quot;                      % &quot;1.2.2&quot; exclude(&quot;commons-codec&quot;, &quot;commons-codec&quot;)

        // caching
        val ehcache                = &quot;net.sf.ehcache&quot;                % &quot;ehcache&quot;                  % &quot;2.10.0&quot;

        // monitoring
        val kamonCore              = &quot;io.kamon&quot;                     %% &quot;kamon-core&quot;               % &quot;1.1.0&quot;
        val kamonAkka              = &quot;io.kamon&quot;                     %% &quot;kamon-akka-2.5&quot;           % &quot;1.0.0&quot;
        val kamonPrometheus        = &quot;io.kamon&quot;                     %% &quot;kamon-prometheus&quot;         % &quot;1.0.0&quot;
        val kamonZipkin            = &quot;io.kamon&quot;                     %% &quot;kamon-zipkin&quot;             % &quot;1.0.0&quot;
        val kamonJaeger            = &quot;io.kamon&quot;                     %% &quot;kamon-jaeger&quot;             % &quot;1.0.1&quot;
        val aspectJWeaver          = &quot;org.aspectj&quot;                   % &quot;aspectjweaver&quot;            % &quot;1.8.13&quot;

        // other
        //&quot;javax.transaction&quot; % &quot;transaction-api&quot; % &quot;1.1-rev-1&quot;,
        val commonsText            = &quot;org.apache.commons&quot;            % &quot;commons-text&quot;             % &quot;1.3&quot;
        val commonsIo              = &quot;commons-io&quot;                    % &quot;commons-io&quot;               % &quot;2.6&quot;
        val commonsBeanUtil        = &quot;commons-beanutils&quot;             % &quot;commons-beanutils&quot;        % &quot;1.9.3&quot; exclude(&quot;commons-logging&quot;, &quot;commons-logging&quot;) // not used by us, but need newest version to prevent this problem: http://stackoverflow.com/questions/14402745/duplicate-classes-in-commons-collections-and-commons-beanutils
        val jodd                   = &quot;org.jodd&quot;                      % &quot;jodd&quot;                     % &quot;3.2.6&quot;
        val jodaTime               = &quot;joda-time&quot;                     % &quot;joda-time&quot;                % &quot;2.9.1&quot;
        val jodaConvert            = &quot;org.joda&quot;                      % &quot;joda-convert&quot;             % &quot;1.8&quot;
        val diff                   = &quot;com.sksamuel.diff&quot;             % &quot;diff&quot;                     % &quot;1.1.11&quot;
        val xmlunitCore            = &quot;org.xmlunit&quot;                   % &quot;xmlunit-core&quot;             % &quot;2.1.1&quot;

        // other
        val rdf4jRuntime           = &quot;org.eclipse.rdf4j&quot;             % &quot;rdf4j-runtime&quot;            % &quot;2.3.2&quot;
        val scallop                = &quot;org.rogach&quot;                   %% &quot;scallop&quot;                  % &quot;2.0.5&quot;
        val gwtServlet             = &quot;com.google.gwt&quot;                % &quot;gwt-servlet&quot;              % &quot;2.8.0&quot;
        val saxonHE                = &quot;net.sf.saxon&quot;                  % &quot;Saxon-HE&quot;                 % &quot;9.7.0-14&quot;

        val scalaXml               = &quot;org.scala-lang.modules&quot;       %% &quot;scala-xml&quot;                % &quot;1.1.0&quot;
        val scalaArm               = &quot;com.jsuereth&quot;                  % &quot;scala-arm_2.12&quot;           % &quot;2.0&quot;
        val scalaJava8Compat       = &quot;org.scala-lang.modules&quot;        % &quot;scala-java8-compat_2.12&quot;  % &quot;0.8.0&quot;

        // provides akka jackson (json) support
        val akkaHttpCirce          = &quot;de.heikoseeberger&quot;            %% &quot;akka-http-circe&quot;          % &quot;1.20.1&quot;
        val jacksonScala           = &quot;com.fasterxml.jackson.module&quot; %% &quot;jackson-module-scala&quot;     % &quot;2.9.4&quot;

        val jsonldJava             = &quot;com.github.jsonld-java&quot;        % &quot;jsonld-java&quot;              % &quot;0.12.0&quot;

        // swagger (api documentation)
        val swaggerAkkaHttp        = &quot;com.github.swagger-akka-http&quot; %% &quot;swagger-akka-http&quot;        % &quot;0.14.0&quot;
    }

lazy val javaRunOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms2G&quot;,
    &quot;-Xmx2G&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;
)

lazy val javaBaseTestOptions = Seq(
    // &quot;-showversion&quot;,
    &quot;-Xms2G&quot;,
    &quot;-Xmx2G&quot;
    // &quot;-verbose:gc&quot;,
    //&quot;-XX:+UseG1GC&quot;,
    //&quot;-XX:MaxGCPauseMillis=500&quot;,
    //&quot;-XX:MaxMetaspaceSize=4096m&quot;
)

lazy val javaTestOptions = Seq(
    &quot;-Dconfig.resource=graphdb.conf&quot;
) ++ javaBaseTestOptions

lazy val FusekiTest = config(&quot;fuseki&quot;) extend(Test)
lazy val javaFusekiTestOptions = Seq(
    &quot;-Dconfig.resource=fuseki.conf&quot;
) ++ javaBaseTestOptions

lazy val FusekiIntegrationTest = config(&quot;fuseki-it&quot;) extend(IntegrationTest)
lazy val javaFusekiIntegrationTestOptions = Seq(
    &quot;-Dconfig.resource=fuseki.conf&quot;
) ++ javaBaseTestOptions

lazy val GraphDBTest = config(&quot;graphdb&quot;) extend(Test)
lazy val javaGraphDBTestOptions = Seq(
    &quot;-Dconfig.resource=graphdb.conf&quot;
) ++ javaBaseTestOptions

lazy val EmbeddedJenaTDBTest = config(&quot;tdb&quot;) extend(Test)
lazy val javaEmbeddedJenaTDBTestOptions = Seq(
    &quot;-Dconfig.resource=jenatdb.conf&quot;
) ++ javaBaseTestOptions

// The &#39;IntegrationTest&#39; config does not need to be created here, as it is a built-in config!
// The standard testing tasks are available, but must be prefixed with &#39;it:&#39;, e.g., &#39;it:test&#39;
// The test need to be stored in the &#39;it&#39; (and not &#39;test&#39;) folder. The standard source hierarchy is used, e.g., &#39;src/it/scala&#39;
lazy val javaIntegrationTestOptions = Seq(
    &quot;-Dconfig.resource=graphdb.conf&quot;
) ++ javaBaseTestOptions


// Create a new MergeStrategy for aop.xml files, as the aop.xml file is present in more than one package.
// When we create a fat JAR (assembly task), then we need to resolve this conflict.
val aopMerge: MergeStrategy = new MergeStrategy {
    val name = &quot;aopMerge&quot;
    import scala.xml._
    import scala.xml.dtd._

    def apply(tempDir: File, path: String, files: Seq[File]): Either[String, Seq[(File, String)]] = {
        val dt = DocType(&quot;aspectj&quot;, PublicID(&quot;-//AspectJ//DTD//EN&quot;, &quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;), Nil)
        val file = MergeStrategy.createMergeTarget(tempDir, path)
        val xmls: Seq[Elem] = files.map(XML.loadFile)
        val aspectsChildren: Seq[Node] = xmls.flatMap(_ \\ &quot;aspectj&quot; \ &quot;aspects&quot; \ &quot;_&quot;)
        val weaverChildren: Seq[Node] = xmls.flatMap(_ \\ &quot;aspectj&quot; \ &quot;weaver&quot; \ &quot;_&quot;)
        val options: String = xmls.map(x =&gt; (x \\ &quot;aspectj&quot; \ &quot;weaver&quot; \ &quot;@options&quot;).text).mkString(&quot; &quot;).trim
        val weaverAttr = if (options.isEmpty) Null else new UnprefixedAttribute(&quot;options&quot;, options, Null)
        val aspects = new Elem(null, &quot;aspects&quot;, Null, TopScope, false, aspectsChildren: _*)
        val weaver = new Elem(null, &quot;weaver&quot;, weaverAttr, TopScope, false, weaverChildren: _*)
        val aspectj = new Elem(null, &quot;aspectj&quot;, Null, TopScope, false, aspects, weaver)
        XML.save(file.toString, aspectj, &quot;UTF-8&quot;, xmlDecl = false, dt)
        IO.append(file, IO.Newline.getBytes(IO.defaultCharset))
        Right(Seq(file -&gt; path))
    }
}

// Use defaultMergeStrategy with a case for aop.xml
// I like this better than the inline version mentioned in assembly&#39;s README
val customMergeStrategy: String =&gt; MergeStrategy = {
    case PathList(&quot;META-INF&quot;, &quot;aop.xml&quot;) =&gt;
        aopMerge
    case PathList(ps @ _*) if ps.exists(_.contains(&quot;aopalliance&quot;)) || ps.exists(_.contains(&quot;lucene&quot;)) || ps.exists(_.contains(&quot;joda&quot;)) =&gt;
        // Workaround for #855. TODO: find a better way to resolve these conflicts.
        MergeStrategy.first
    case s =&gt;
        defaultMergeStrategy(s)
}</code></pre>
<h2><a href="#webapi-server-startup-flags" name="webapi-server-startup-flags" class="anchor"><span class="anchor-link"></span></a>Webapi Server Startup-Flags</h2>
<p>The Webapi-Server can be started with a number of flags. These flags can be supplied either to the <code>reStart</code> or the <code>run</code> command in sbt, e.g.,:</p>
<pre><code>$ sbt
&gt; reStart flag
</code></pre>
<p>or</p>
<pre><code>$ sbt
&gt; run flag
</code></pre>
<h3><a href="#loaddemodata-flag" name="loaddemodata-flag" class="anchor"><span class="anchor-link"></span></a><code>loadDemoData</code> - Flag</h3>
<p>When the webapi-server is started with the <code>loadDemoData</code> flag, then at startup, the data which is configured in <code>application.conf</code> under the <code>app.triplestore.rdf-data</code> key is loaded into the triplestore, and any data in the triplestore is removed beforehand.</p>
<p>Usage:</p>
<pre><code>$ sbt
&gt; reStart loadDemoData
</code></pre>
<h3><a href="#allowreloadoverhttp-flag" name="allowreloadoverhttp-flag" class="anchor"><span class="anchor-link"></span></a><code>allowReloadOverHTTP</code> - Flag</h3>
<p>When the webapi.server is started with the <code>allowReloadOverHTTP</code> flag (<code>reStart -r</code>), then the <code>v1/store/ResetTriplestoreContent</code> route is activated. This route accepts a <code>POST</code> request, with a JSON payload consisting of the following example content:</p>
<pre><code>[
  {
    &quot;path&quot;: &quot;../knora-ontologies/knora-base.ttl&quot;,
    &quot;name&quot;: &quot;http://www.knora.org/ontology/knora-base&quot;
  },
  {
    &quot;path&quot;: &quot;../knora-ontologies/salsah-gui.ttl&quot;,
    &quot;name&quot;: &quot;http://www.knora.org/ontology/salsah-gui&quot;
  },
  {
    &quot;path&quot;: &quot;_test_data/ontologies/incunabula-onto.ttl&quot;,
    &quot;name&quot;: &quot;http://www.knora.org/ontology/0803/incunabula&quot;
  },
  {
    &quot;path&quot;: &quot;_test_data/all_data/incunabula-data.ttl&quot;,
    &quot;name&quot;: &quot;http://www.knora.org/data/incunabula&quot;
  }
]
</code></pre>
<p>This content corresponds to the payload sent with the <code>ResetTriplestoreContent</code> message, defined inside the <code>org.knora.webapi.messages.v1.store.triplestoremessages</code> package. The <code>path</code> being the relative path to the <code>ttl</code> file which will be loaded into a named graph by the name of <code>name</code>.</p>
<p>Usage:</p>
<pre><code>$ sbt
&gt; reStart allowReloadOverHTTP
</code></pre>
</div>
<div>
<a href="https://github.com/dhlab-basel/Knora/tree/master/src/paradox/05-internals/development/build-process.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
v1.5.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../05-internals/development/graphdb.html" title="Starting GraphDB" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Starting GraphDB
</span>
</div>
</a>
<a href="../../05-internals/development/intellij-config.html" title="Setup IntelliJ for development of Knora" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Setup IntelliJ for development of Knora
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright 2015-2018 the contributors (see Contributors.md)
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/dhlab-basel" class="md-footer-social__link fa fa-github"></a><a href="https://twitter.com/dhlabbasel" class="md-footer-social__link fa fa-twitter"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.5165553b.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
